# 语言特性

Lua 有一些其他脚本语言与众不同的特点。这里就简单介绍一下。

## 寄存器式虚拟机

虚拟机实现分为两类：栈式和寄存器式。

栈式虚拟机概念很简单，就是所有的指令执行，都是基于一个操作数栈的。你想要执行任何指令都得先入栈，然后执行结束再一个个出栈。

类似与要实现 a = b + c 这一运算：

栈式的一般会转为如下指令:

- 把 b 的值压入栈中
- 把 c 的值压入栈中
- 把 b 与 c 从栈中取出相加,并将结果再放入栈中
- 把栈中的数值返回设定到 a 变量上

而寄存器是这样的:

- 将 b 与 c 对应的寄存器的值相加，将结果保存在 a 对应的寄存器中


Lua 5.0 之前是栈式虚拟机，到 5.0 (2003 年) 改用寄存器式。

寄存器式的编译器(并非虚拟机)实现难度要高于栈式的，但同时性能也更高。体现在指令条数以及数据移动次数较少。

注: 如果当前虚拟机使用了 JIT 编译器(直接在虚拟机运行过程中把指令编译成二进制代码)。这两种指令集在 JIT 合理编译下结果也是没有区别的。不过 Lua 并没有官方实现的 JIT。 

## table 数据结构

不同于其他语言有数组与对象两种数据结构，Lua 只有 table 数据结构。table 充当了数组和映射表的双重功能。

```lua
-- 等同于其他语言的数组
local days = {"Sunday", "Monday"}

-- 等同于其他语言的对象
local record = {x = 10, y = 20}

-- 对于列表使用 ipairs, 这里是按照顺序进行的
for k, v in ipairs(days) do
    print(k, v)
end
--> 1 Sunday, 2 Monday

-- 对于对象使用 pairs, 并不保证顺序
for k, v in pairs(days) do
    print(k, v)
end
--> x 10, y 20
```

这里可以看到 Lua 数组从 1 开始计数。

## 布尔判断

Lua 也类似于 JavaScript，任何值都可以表示条件。但不同的是：在 Lua 语言中，只有 boolean 中的 false 与 nil 表示假，其余都是真(包括空字符串和零)。

同时有一些表达式也不尽相同。

- 不使用 &&，而是使用 and
- 不使用 ||，而是 or
- 不使用 ! 而是 not
- 不使用 != 而是 ~=

```lua
4 and 5 --> 5
false and 13 --> false
nil and 13 --> nil
0 or 5 --> 0
not nil --> true
```


